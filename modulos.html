<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Temas â€” CSECV</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="page-modulos">
    <header class="site-header">
      <div class="container nav">
        <a href="/" class="brand" aria-label="CSECV Home">
          <span class="brand-dot" aria-hidden="true"></span>
          CSECV
        </a>
        <nav class="main-nav" aria-label="Principal">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a class="active" href="/temas">Temas</a></li>
            <li><a href="#sobre">Sobre Nosotros</a></li>
            <li><a href="#contacto">Contacto</a></li>
          </ul>
        </nav>
        <div class="nav-actions">
          <button class="btn btn-text" id="btn-login" aria-label="Iniciar sesiÃ³n">Iniciar SesiÃ³n</button>
          <button class="btn btn-ghost" id="btn-logout" style="display:none" aria-label="Cerrar sesiÃ³n">Salir</button>
          <button class="btn btn-ghost" id="btn-user" style="display:none" aria-label="Perfil"></button>
        </div>
        <button class="nav-toggle" id="navToggle" aria-label="Abrir menÃº">â˜°</button>
      </div>
    </header>

    <main class="container">
      <section class="modules-header">
        <h1>Bienvenido de vuelta</h1>
        <p class="lead center">Â¿QuÃ© tema quieres fortalecer hoy?</p>
      </section>

      <section class="modules-grid" id="modulesGrid">
        <!-- Los mÃ³dulos se cargarÃ¡n dinÃ¡micamente desde la API -->
      </section>
    </main>

    <script src="/app.js"></script>
    <script>
      // Cargar temas desde API
      async function loadTopics() {
        try {
          const res = await fetch('/api/v2/topics');
          const topics = await res.json();
          const grid = document.getElementById('modulesGrid');
          
          if (!grid || topics.length === 0) {
            grid.innerHTML = '<p class="center">No hay temas disponibles aÃºn.</p>';
            return;
          }
          
          const resolveImagePath = (path) => {
            if (!path) return '';
            if (path.startsWith('http://') || path.startsWith('https://')) return path;
            return path.startsWith('/') ? path : '/' + path;
          };

          grid.innerHTML = topics.map(topic => {
            const img = topic.imageAssetId ? ('/assets/' + topic.imageAssetId) : resolveImagePath(topic.imagePath || '');
            return `
              <a class="module-card" href="/m/${topic.slug}">
                ${img ? `<img src="${img}" alt="${topic.title}" style="width:64px;height:64px;border-radius:16px;object-fit:cover;border:1px solid rgba(255,255,255,.12)" />` : `<div class="module-icon">ðŸ“š</div>`}
                <h3>${topic.title}</h3>
                <p>${topic.description || ''}</p>
              </a>
            `;
          }).join('');
        } catch (error) {
          console.error('Error cargando temas:', error);
          document.getElementById('modulesGrid').innerHTML = '<p class="center">Error cargando temas.</p>';
        }
      }
      
      // Cargar cuando la pÃ¡gina estÃ© lista
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadTopics);
      } else {
        loadTopics();
      }
    </script>
  </body>
  </html>
